#include <stdio.h>
#include <stdlib.h>
#include <errno.h>
#include <sys/iofunc.h>
#include <sys/netmgr.h>
#include <pthread.h>

//#define FILE_LOCATION "/tmp/trafficLightServer.info"
#define FILE_LOCATION "/net/serverAditya/tmp/trafficLightServer.info"

typedef struct{
	int serverProcessId;
	int serverChannelId;
}serverIds;

size_t read_data( FILE *fp, serverIds *p )
{
    return( fread( p, sizeof( serverIds ), 1, fp ) );
}

// This function will perform direct mutation to accessIds
// and store serverChannelId, and serverProcessId, where those two properties were created by server-side
void getServerIds(serverIds *accessIds){
	FILE *file;
	serverIds ids;
	file = fopen(FILE_LOCATION, "r");
	if(file != NULL){
		if(read_data(file, &ids)!= 0){
			accessIds->serverChannelId =ids.serverChannelId;
			accessIds->serverProcessId =ids.serverProcessId;
			printf("Successfully get Server Connection and Channel IDs from file\n"); // logs successful read && get method
		}else{
			printf("ERROR: Cannot read file\n"); // logs unsuccessful read method
		}
	}else{
		printf("Cannot open the file\n"); // logs unsuccessfuly file opening process
	}
	fclose(file);
}

int main(void) {
	serverIds serverAccessIds;
	getServerIds(&serverAccessIds);
	printf("%d\n", serverAccessIds.serverProcessId);
	printf("%d\n", serverAccessIds.serverChannelId);
	return EXIT_SUCCESS;
}
